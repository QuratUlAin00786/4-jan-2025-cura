QUICKBOOKS WEBHOOK INTEGRATION IN NODE.JS (FULL GUIDE)
ğŸ“ 1. Project Folder Structure
quickbooks-webhook/
â”‚
â”œâ”€ server.js
â”œâ”€ services/
â”‚   â”œâ”€ quickbooksApi.js
â”‚   â””â”€ webhookProcessor.js
â”œâ”€ utils/
â”‚   â””â”€ verifySignature.js
â””â”€ package.json

ğŸ“¦ 2. Install Required Packages
npm init -y
npm install express crypto axios body-parser

ğŸš€ 3. server.js (Main Webhook Entry Point)
const express = require("express");
const bodyParser = require("body-parser");
const verifySignature = require("./utils/verifySignature");
const processWebhook = require("./services/webhookProcessor");

const app = express();

// Express needs RAW BODY for signature verification
app.use(
  "/webhook/quickbooks",
  bodyParser.raw({ type: "application/json" })
);

app.post("/webhook/quickbooks", (req, res) => {
  const signature = req.headers["intuit-signature"];
  const body = req.body;

  // 1. Verify Signature
  const isValid = verifySignature(body, signature);

  if (!isValid) {
    console.log("âŒ Invalid Webhook Signature");
    return res.status(401).send("Invalid signature");
  }

  // 2. Accept Immediately
  res.status(200).send("OK");

  // 3. Process Asynchronously
  const jsonData = JSON.parse(body.toString());
  processWebhook(jsonData);
});

app.listen(4000, () => console.log("ğŸš€ Server running on port 4000"));

ğŸ”’ 4. Verify Signature (HMAC-SHA256)

ğŸ‘‰ File: utils/verifySignature.js

const crypto = require("crypto");

// Replace with your Intuit Client Secret
const CLIENT_SECRET = "YOUR_CLIENT_SECRET";

module.exports = function verifySignature(rawBody, signatureHeader) {
  const hmac = crypto.createHmac("sha256", CLIENT_SECRET);
  hmac.update(rawBody);

  const digest = hmac.digest("base64");

  return digest === signatureHeader;
};


âš ï¸ This step is required â€” QuickBooks rejects your app if missing.

ğŸ”„ 5. Process Webhook Events

ğŸ‘‰ File: services/webhookProcessor.js

const qbApi = require("./quickbooksApi");

module.exports = async function processWebhook(data) {
  const events = data.eventNotifications;

  for (const event of events) {
    const realmId = event.realmId;

    for (const entity of event.dataChangeEvent.entities) {
      console.log(`ğŸ“¥ Event: ${entity.name} - ${entity.operation} (ID: ${entity.id})`);

      // Retrieve full updated data from QuickBooks API
      const fullData = await qbApi.getEntity(realmId, entity);

      // TODO: Save fullData to your database here
      console.log(`âœ” Synced ${entity.name} ${entity.operation}`, fullData);
    }
  }
};

ğŸŒ 6. QuickBooks API Helper (Fetch Full Data)

ğŸ‘‰ File: services/quickbooksApi.js

const axios = require("axios");

let ACCESS_TOKEN = "YOUR_QB_ACCESS_TOKEN";  // Replace with real token

module.exports = {
  async getEntity(realmId, entity) {
    const url = `https://quickbooks.api.intuit.com/v3/company/${realmId}/${entity.name.toLowerCase()}/${entity.id}`;

    try {
      const response = await axios.get(url, {
        headers: {
          Authorization: `Bearer ${ACCESS_TOKEN}`,
          Accept: "application/json"
        }
      });

      return response.data;
    } catch (err) {
      console.error("âŒ API error:", err.response?.data || err.message);
      return null;
    }
  }
};

âš™ï¸ 7. Your Webhook URL (Use This in Intuit Dashboard)

Use this format:

https://yourdomain.com/webhook/quickbooks


For your app:

https://app.curaemr.ai/webhook/quickbooks


Add it under:

Intuit Developer Dashboard â†’ App Settings â†’ Webhooks

ğŸ§ª 8. Testing Webhooks (Sandbox)

Enable Webhooks in your QuickBooks Sandbox App

Add webhook URL

Perform actions in sandbox:

Create customer

Create invoice

Watch your server terminal

You should see events printed like:

ğŸ“¥ Event: Invoice - Create (ID: 57)
âœ” Synced Invoice Create { ... }

ğŸ”’ 9. Security Best Practices

âœ” Use https
âœ” Validate HMAC-SHA256 signature
âœ” Respond with 200 OK in < 5 seconds
âœ” Process heavy tasks asynchronously
âœ” Refresh QuickBooks access token using OAuth2

ğŸ¯ 10. Optional Enhancements

I can also provide:

ğŸ”¥ Automatic Token Refresh
ğŸ”¥ Database integration (MongoDB, MySQL, PostgreSQL)
ğŸ”¥ Sync logic for invoices, customers, payments
ğŸ”¥ Full QuickBooks OAuth2 login flow
ğŸ”¥ Production-ready error handling